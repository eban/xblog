---
title: 来年まであとどれくらい？
date: 2021-11-27 15:37:21 +0900
layout: blog
---

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">2022年まであと35日と1時間56分40秒 <a href="https://t.co/VRplfsDEuR">https://t.co/VRplfsDEuR</a></p>&mdash; シェル芸bot (@minyoruminyon) <a href="https://twitter.com/minyoruminyon/status/1464218213714362369?ref_src=twsrc%5Etfw">November 26, 2021</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">date -d &quot;12/31 $(($(date -d &#39;year 1/1&#39; +%s) - $(date +%s))) sec&quot; +&#39;%Y年まであと%-j日と%-H時間%-M分%-S秒&#39;<a href="https://twitter.com/hashtag/%E3%82%B7%E3%82%A7%E3%83%AB%E8%8A%B8?src=hash&amp;ref_src=twsrc%5Etfw">#シェル芸</a></p>&mdash; eban (@eban) <a href="https://twitter.com/eban/status/1464218187898429441?ref_src=twsrc%5Etfw">November 26, 2021</a></blockquote>

## 解説
まずは来年までの秒数を求める。
year 1/1と指定すれば来年の1月1日0時を意味する。
```console
% date -d 'year 1/1'
Sat Jan  1 00:00:00 JST 2022
```
+%sでUNIX秒にして現在との差分を取れば来年までの秒数になる。
```console
% echo $(($(date -d 'year 1/1' +%s) - $(date +%s)))
2967400
```
つぎにこの秒数を割ったり余りを求めたりすれば日数や時間も得られるが面倒なので、
dateにやらせる。

日数は
```console
% date --help|grep %j
  %j   年の開始日からの日数 (001..366)
```
のように、%jで得られるので、起点を12/31にしてあげるとうまいこと表示することができる。
```console
% date -d '12/31 2967400 sec' +'%j %H:%M:%S'
034 08:16:40
```
あとは体裁を整えればok。-をつければ先頭の0を消すことができる。

## バグ
お気付きの通り12/31に実行すると「あと365日...」などと間抜けな表示をする。
